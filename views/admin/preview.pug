extends layout

block content
  div(class="space-y-6")
    div(class="flex items-center justify-between")
      div
        h2(class="text-xl font-semibold text-gray-900") Preview Website
        p(class="text-gray-600 mt-1") Lihat tampilan website dari perspektif pengunjung
      
      div(class="flex items-center space-x-3")
        select(id="deviceSelector" onchange="changeDevice()" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent")
          option(value="desktop") Desktop
          option(value="tablet") Tablet
          option(value="mobile") Mobile
        
        button(onclick="refreshPreview()" class="bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700 transition-colors font-medium") Refresh

    div(class="bg-white rounded-lg shadow p-4")
      div(class="flex items-center justify-between mb-4")
        h3(class="font-medium text-gray-900") Navigasi Preview
        
        div(class="flex items-center space-x-2")
          button(onclick="goBack()" class="p-2 text-gray-600 hover:text-gray-800 disabled:opacity-50" id="backBtn")
            svg(class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24")
              path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7")
          
          button(onclick="goForward()" class="p-2 text-gray-600 hover:text-gray-800 disabled:opacity-50" id="forwardBtn")
            svg(class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24")
              path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7")
          
          div(class="w-px h-6 bg-gray-300")
          
          button(onclick="openInNewTab()" class="p-2 text-gray-600 hover:text-gray-800" title="Buka di tab baru")
            svg(class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24")
              path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14")
      
      div(class="flex flex-wrap gap-2")
        button(onclick="navigateTo('/')" class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors") Home
        button(onclick="navigateTo('/ongoing')" class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors") Ongoing
        button(onclick="navigateTo('/complete')" class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors") Complete
        button(onclick="navigateTo('/search')" class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors") Search
        button(onclick="navigateTo('/genres')" class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors") Genres
        
        div(class="w-px h-6 bg-gray-300")
        
        button(onclick="navigateTo('/anime/one-piece')" class="px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors") Sample Anime
        button(onclick="navigateTo('/anime/one-piece/episode/1')" class="px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors") Sample Episode

    div(class="bg-white rounded-lg shadow overflow-hidden")
      div(class="bg-gray-100 px-4 py-2 border-b border-gray-200 flex items-center justify-between")
        div(class="flex items-center space-x-2")
          div(class="w-3 h-3 bg-red-400 rounded-full")
          div(class="w-3 h-3 bg-yellow-400 rounded-full")
          div(class="w-3 h-3 bg-green-400 rounded-full")
        
        div(class="flex-1 mx-4")
          input(type="text" id="urlBar" value="/" onkeypress="handleUrlKeypress(event)" class="w-full px-3 py-1 text-sm bg-white border border-gray-300 rounded focus:ring-2 focus:ring-primary-500 focus:border-transparent")
        
        div(class="text-sm text-gray-500" id="deviceIndicator") Desktop
      
      div(id="previewContainer" class="relative bg-gray-50")
        iframe(id="previewFrame" src="/" class="w-full border-0 transition-all duration-300" style="height: 800px;")
        
        div(id="loadingOverlay" class="absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center hidden")
          div(class="flex items-center space-x-3")
            svg(class="animate-spin w-6 h-6 text-primary-600" fill="none" viewBox="0 0 24 24")
              circle(class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4")
              path(class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z")
            span(class="text-gray-600") Loading...

    div(class="bg-blue-50 border border-blue-200 rounded-lg p-4")
      div(class="flex items-start space-x-3")
        svg(class="w-5 h-5 text-blue-600 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24")
          path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z")
        
        div(class="text-sm text-blue-800")
          p(class="font-medium mb-1") Tips Preview:
          ul(class="space-y-1 text-blue-700")
            li • Gunakan selector device untuk melihat tampilan responsive
            li • Klik tombol navigasi cepat untuk berpindah halaman
            li • Ketik URL di address bar dan tekan Enter untuk navigasi manual
            li • Buka di tab baru untuk testing yang lebih detail

block scripts
  script.
    let currentUrl = '/';
    let history = ['/'];
    let historyIndex = 0;

    function changeDevice() {
      const device = document.getElementById('deviceSelector').value;
      const frame = document.getElementById('previewFrame');
      const indicator = document.getElementById('deviceIndicator');
      
      switch(device) {
        case 'mobile':
          frame.style.width = '375px';
          frame.style.height = '667px';
          frame.style.margin = '0 auto';
          indicator.textContent = 'Mobile (375px)';
          break;
        case 'tablet':
          frame.style.width = '768px';
          frame.style.height = '1024px';
          frame.style.margin = '0 auto';
          indicator.textContent = 'Tablet (768px)';
          break;
        default:
          frame.style.width = '100%';
          frame.style.height = '800px';
          frame.style.margin = '0';
          indicator.textContent = 'Desktop';
      }
    }

    function navigateTo(url) {
      showLoading();
      currentUrl = url;
      
      if (historyIndex === history.length - 1) {
        history.push(url);
        historyIndex = history.length - 1;
      }
      
      document.getElementById('urlBar').value = url;
      document.getElementById('previewFrame').src = url;
      updateNavigationButtons();
    }

    function goBack() {
      if (historyIndex > 0) {
        historyIndex--;
        const url = history[historyIndex];
        navigateToHistory(url);
      }
    }

    function goForward() {
      if (historyIndex < history.length - 1) {
        historyIndex++;
        const url = history[historyIndex];
        navigateToHistory(url);
      }
    }

    function navigateToHistory(url) {
      showLoading();
      currentUrl = url;
      document.getElementById('urlBar').value = url;
      document.getElementById('previewFrame').src = url;
      updateNavigationButtons();
    }

    function updateNavigationButtons() {
      document.getElementById('backBtn').disabled = historyIndex <= 0;
      document.getElementById('forwardBtn').disabled = historyIndex >= history.length - 1;
    }

    function handleUrlKeypress(event) {
      if (event.key === 'Enter') {
        const url = event.target.value;
        navigateTo(url);
      }
    }

    function refreshPreview() {
      showLoading();
      document.getElementById('previewFrame').src = currentUrl + '?refresh=' + Date.now();
    }

    function openInNewTab() {
      window.open(currentUrl, '_blank');
    }

    function showLoading() {
      document.getElementById('loadingOverlay').classList.remove('hidden');
    }

    function hideLoading() {
      document.getElementById('loadingOverlay').classList.add('hidden');
    }

    document.getElementById('previewFrame').addEventListener('load', function() {
      hideLoading();
      
      try {
        const frameUrl = this.contentWindow.location.pathname;
        if (frameUrl !== currentUrl) {
          currentUrl = frameUrl;
          document.getElementById('urlBar').value = frameUrl;
        }
      } catch (e) {
      }
    });

    updateNavigationButtons();
    changeDevice();
