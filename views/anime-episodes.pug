extends layout

block content
  div(class="container mx-auto px-4 py-6")
    div(class="grid grid-cols-1 lg:grid-cols-4 gap-8")
      div(class="lg:col-span-3")
        nav(class="mb-4")
          ol(class="flex items-center space-x-2 text-sm text-gray-500")
            li: a(href="/" class="hover:text-primary-600") Beranda
            li: span /
            li: a(href=`/anime/${anime.slug}` class="hover:text-primary-600")= anime.title
            li: span /
            li(class="text-gray-900 font-medium") Episode List

        div(class="bg-white rounded-lg shadow-sm p-6 mb-6")
          div(class="flex items-start space-x-4")
            img(src=anime.poster alt=anime.title class="w-24 h-32 object-cover rounded-lg flex-shrink-0" onerror="this.onerror=null;this.src='https://placehold.co/400x600?text=No+Image';")
            div(class="flex-1")
              h1(class="text-xl md:text-2xl font-bold text-gray-900 mb-2")= `Episode ${anime.title}`
              if anime.synopsis
                p(class="text-gray-600 text-sm leading-relaxed line-clamp-3")= anime.synopsis
              div(class="flex items-center space-x-4 mt-4")
                a(href=`/anime/${anime.slug}` class="text-primary-600 hover:text-primary-700 font-medium text-sm") ← Kembali ke Detail
                if episodes && episodes.length > 0
                  span(class="text-sm text-gray-500")= `${episodes.length} Episode`

        if episodes && episodes.length > 0
          div(class="bg-white rounded-lg shadow-sm p-6 mb-6")
            h2(class="text-lg font-bold text-gray-900 mb-4") Daftar Episode
            div(class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-3")
              each episode in episodes
                a(href=`/anime/${anime.slug}/episode/${episode.episode}` class="bg-gray-50 hover:bg-primary-50 border border-gray-200 hover:border-primary-200 rounded-lg p-3 text-center transition-colors group")
                  div(class="text-sm font-medium text-gray-900 group-hover:text-primary-700") Episode #{episode.episode}
                  if episode.release_date
                    div(class="text-xs text-gray-500 mt-1")= episode.release_date
                  if episode.duration
                    div(class="text-xs text-gray-400 mt-1")= episode.duration

        else
          div(class="bg-white rounded-lg shadow-sm p-6 mb-6")
            div(class="text-center py-8")
              svg(class="w-12 h-12 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z")
              h3(class="text-lg font-medium text-gray-900 mb-2") Belum ada episode
              p(class="text-gray-600") Episode untuk anime ini belum tersedia

        if adSlots && adSlots.contentBottom && adSlots.contentBottom.length > 0
          div(class="mb-6")
            each ad in adSlots.contentBottom
              div(class="ad-slot bg-gray-100 rounded-lg")!= ad.content

      div(class="lg:col-span-1")
        if adSlots && adSlots.sidebarTop && adSlots.sidebarTop.length > 0
          div(class="mb-6")
            each ad in adSlots.sidebarTop
              div(class="ad-slot bg-gray-100 rounded-lg")!= ad.content

        div(class="bg-white rounded-lg shadow-sm p-6 mb-6")
          h3(class="font-bold text-gray-900 mb-4") Informasi Anime
          div(class="space-y-3 text-sm")
            if anime.title
              div
                span(class="font-medium text-gray-700") Judul:
                span(class="text-gray-600 ml-2")= anime.title
            if anime.status
              div
                span(class="font-medium text-gray-700") Status:
                span(class="text-gray-600 ml-2")= anime.status
            if anime.release_year
              div
                span(class="font-medium text-gray-700") Tahun:
                span(class="text-gray-600 ml-2")= anime.release_year
            if episodes && episodes.length > 0
              div
                span(class="font-medium text-gray-700") Total Episode:
                span(class="text-gray-600 ml-2")= episodes.length

        div(class="bg-white rounded-lg shadow-sm p-6 mb-6")
          h3(class="font-bold text-gray-900 mb-4") Aksi Cepat
          div(class="space-y-3")
            a(href=`/anime/${anime.slug}` class="flex items-center text-gray-600 hover:text-primary-600 transition-colors")
              svg(class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z")
              span Detail Anime
            if episodes && episodes.length > 0
              a(href=`/anime/${anime.slug}/episode/${episodes[0].episode === 0 ? 1 : episodes[0].episode}` class="flex items-center text-gray-600 hover:text-primary-600 transition-colors")
                svg(class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                  path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h8m-9-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z")
                span Mulai Nonton
            if anime.batch_links && anime.batch_links.length > 0
              a(href=`/anime/${anime.slug}/batch` class="flex items-center text-gray-600 hover:text-primary-600 transition-colors")
                svg(class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                  path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z")
                span Download Batch

        if adSlots && adSlots.sidebarBottom && adSlots.sidebarBottom.length > 0
          div(class="mb-6")
            each ad in adSlots.sidebarBottom
              div(class="ad-slot bg-gray-100 rounded-lg")!= ad.content

block scripts
  script.
    if ('IntersectionObserver' in window) {
      const episodeObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('animate-fadeIn');
            episodeObserver.unobserve(entry.target);
          }
        });
      });

      document.querySelectorAll('.episode-card').forEach(card => {
        episodeObserver.observe(card);
      });
    }
